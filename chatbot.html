<!DOCTYPE html>
<html>
  <head>
    <title>Chat Bot </title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>

      body {
        font-family:  'Times New Roman', Times, serif;
        margin: 20px;
        font-size: 15px;
      }

      input#chat-input {
        padding: 12px 20px;
        box-sizing: border-box;
        border: 2px solid #ccc;
        border-radius: 10px;
        cursor: pointer;
        flex-grow: 1; /** Make input take available space **/
      }

      .send-button {
        background-color: rgb(50, 241, 50);
        color: white;
        padding: 12px 20px;
        margin-left: 10px;
        margin-right: 2.5px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
      }

      .reset-button {
        background-color: red;
        color: white;
        padding: 12px 20px;
        border: none; 
        border-radius: 10px;
        cursor: pointer;
      }

      .chat-input-container {
        margin-bottom: 20px;
        display: flex;
      }

      .app-container {
        border-radius: 10px;
        padding: 20px;
        max-width: 600px;
        margin: auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        height: 80 vh;
      }


      .chat-message{
        display: flex;
        justify-content: start;
        padding: 5px;
        align-items: start;
      }

      .user-message {
        display: flex;
        justify-content: end;
        align-items: start;
      }

      .message-text {
        background-color: #f1f1f1;
        border-radius: 10px;
        padding: 15px 20px;
        margin-right: 10px;
        max-width: 80%;
        word-wrap: break-word;
        margin-left: 10px;
        margin-bottom: 20px;
      }

      .message-avatar{
        width: 45px;      
      }


      .chat-messages-container {
        height: 60vh;
        overflow-y: auto;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 10px;
        background-color: #fafafa;
      }
    </style>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev@8.6.4/react.js"></script>
    <script src="https://unpkg.com/supersimpledev@8.6.4/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev@8.6.4/babel.js
    "></script>
    <script type="text/babel">

      function ChatInput({chatMessages, setChatMessages}) {

        const [inputText, setInputText] = React.useState("")


        function saveInputText(e){
          setInputText(e.target.value);          
        }


        function sendMessage(){

          if(!inputText.trim()){
            return; // Do not send empty messages
          }
          const newChatMessages = [
              ...chatMessages,
              {
                message: inputText,
                sender: "user",
                id: crypto.randomUUID()
              }];
          setChatMessages(newChatMessages);

          const response = Chatbot.getResponse(inputText);
          
          setChatMessages([
              ...newChatMessages,
              {
                message: response,
                sender: "bot",
                id: crypto.randomUUID()
              }]
            );
              
          // Clear input field after sending message
          setInputText("");
        }

        return (
          <div className="chat-input-container">
            <input  
              id="chat-input" 
              placeholder="Send a message to chatbox" 
              size="30"
              onChange={saveInputText} 
              value={inputText}
            />
            <button 
              onClick={sendMessage}
              className="send-button"
            >
              Send
            </button>
          </div>
        );
      }

      // Props are inputs to a React component. Destructuring assignment is used here.
      function ChatMessage({message, sender}) {
      
        const isBot = sender === "bot";

        return (
          <>
            {message &&(
              <div className={`chat-message ${isBot ? 'bot-message' : 'user-message'}`}>
            {isBot && 
              (<img src="bot.png" height="50" width="50" className="message-avatar"/>)}
            <div className="message-text">
              {message}
            </div>
            {!isBot && 
              (<img src="user.png" height="50" width="50" className="message-avatar"/>)}
          </div>
            )}
          </>
          
        );
      }

      /*Component are piece of the website
      Chatbot project has 2 component, ChatInput and ChatMessage
      App component is the main component that uses the other 2 components
      props are used to pass data to components
      Destructuring assignment is used to extract props in ChatMessage component
      Guard operators are used to conditionally render elements based on the sender prop
      Const isBot is used to check if the sender is bot or user
*/


      function ChatMessages({chatMessages, setChatMessages}){

          return (
            <div className="chat-messages-container">
            {/* Event handling
            <button onClick={handleSendMessage}>Send Message</button>
            */}
            {
              chatMessages.map((chat, index) => {
                  return (
                    <ChatMessage 
                      key={index} 
                      message={chat.message} 
                      sender={chat.sender} />
                  );
              })}
            </div>
          );
      }



      function App() {     
        // array destructuring assignment to create state variable chatMessages and function setChatMessages to update it
        const [chatMessages, setChatMessages] = React.useState([]);


        return (
          <div className="app-container">
             
            <ChatMessages 
              chatMessages={chatMessages} 
              setChatMessages={setChatMessages} 
            />
            <ChatInput 
              setChatMessages={setChatMessages} 
              chatMessages={chatMessages}
            />
            <>
              <button className="reset-button" onClick={() => setChatMessages([])}>Reset</button>
            </>
          </div>
        );
      }

      const container = document.querySelector('.js-container');

      ReactDOM.createRoot(container).render(<App />);
      /*
      Fragments (<>)let you group a list 
      of children without adding extra
      nodes to the DOM.
      */

      /* 
      Save data using arrays and objects
      Generate the html using map function and key prop
      application is interactive using event handling like onClick and onChange
      State management using useState hook - data that changes over time and affects rendering
      update functions to modify state and trigger re-rendering by updating the state and passing new data as props
      array destructuring assignment to extract state variable and update function from useState hook
      lift state up to common ancestor component (App) to share state between sibling components (ChatInput and ChatMessages)
      */
    </script>
  </body>
</html>
