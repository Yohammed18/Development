<!DOCTYPE html>
<html>
  <head>
    <title>Chat Bot Basics</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev@8.6.4/react.js"></script>
    <script src="https://unpkg.com/supersimpledev@8.6.4/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev@8.6.4/babel.js
    "></script>
    <script type="text/babel">

      function ChatInput({chatMessages, setChatMessages}) {

        const [inputText, setInputText] = React.useState("")


        function saveInputText(e){
          setInputText(e.target.value);          
        }


        function sendMessage(){

          const newChatMessages = [
              ...chatMessages,
              {
                message: inputText,
                sender: "user",
                id: crypto.randomUUID()
              }];
          setChatMessages(newChatMessages);

          const response = Chatbot.getResponse(inputText);
          
          setChatMessages([
              ...newChatMessages,
              {
                message: response,
                sender: "bot",
                id: crypto.randomUUID()
              }]
            );
              
          // Clear input field after sending message
          setInputText("");
        }

        return (
          <>
            <input  
              id="chat-input" 
              placeholder="Send a message to chatbox" 
              size="30"
              onChange={saveInputText} 
              value={inputText}
            />
            <button onClick={sendMessage}>Send</button>
          </>
        );
      }

      // Props are inputs to a React component. Destructuring assignment is used here.
      function ChatMessage({message, sender}) {
      
        const isBot = sender === "bot";

        return (
          <div style={{padding: "10px"}}>
            {isBot && 
              (<img src="bot.png" height="50" width="50" />)}
            {message}
            {!isBot && 
              (<img src="user.png" height="50" width="50" />)}
          </div>
        );
      }

      /*Component are piece of the website
      Chatbot project has 2 component, ChatInput and ChatMessage
      App component is the main component that uses the other 2 components
      props are used to pass data to components
      Destructuring assignment is used to extract props in ChatMessage component
      Guard operators are used to conditionally render elements based on the sender prop
      Const isBot is used to check if the sender is bot or user
*/


      function ChatMessages({chatMessages, setChatMessages}){
          return (
            <>
            {/* Event handling
            <button onClick={handleSendMessage}>Send Message</button>
            */}
            {
              chatMessages.map((chat, index) => {
                  return (
                    <ChatMessage 
                      key={index} 
                      message={chat.message} 
                      sender={chat.sender} />
                  );
              })}
            </>
          );
      }



      function App() {     
        // array destructuring assignment to create state variable chatMessages and function setChatMessages to update it
        const [chatMessages, setChatMessages] = React.useState([]);


        return (
          <>
            <ChatInput 
              setChatMessages={setChatMessages} 
              chatMessages={chatMessages}
            /> 
            <ChatMessages 
              chatMessages={chatMessages} 
              setChatMessages={setChatMessages} 
            />
            <div>
              <button onClick={() => setChatMessages([])}>Reset</button>
            </div>
          </>
        );
      }

      const container = document.querySelector('.js-container');

      ReactDOM.createRoot(container).render(<App />);
      /*
      Fragments (<>)let you group a list 
      of children without adding extra
      nodes to the DOM.
      */

      /* 
      Save data using arrays and objects
      Generate the html using map function and key prop
      application is interactive using event handling like onClick and onChange
      State management using useState hook - data that changes over time and affects rendering
      update functions to modify state and trigger re-rendering by updating the state and passing new data as props
      array destructuring assignment to extract state variable and update function from useState hook
      lift state up to common ancestor component (App) to share state between sibling components (ChatInput and ChatMessages)
      */
    </script>
  </body>
</html>
